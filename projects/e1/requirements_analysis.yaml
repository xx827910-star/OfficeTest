project_id: e1
source_documents:
  filtered_md: projects/e1/input/filtered.md
  implementation_notes: best_practices/implementation_notes.md
explicit_requirements:
  document_settings:
    page_size: A4
    margins_cm:
      top: null
      bottom: null
      left: null
      right: null
    notes: "规范仅给出A4纸张，未给出页边距；如无进一步样例可沿用模板默认值 (上2.5/下2.5/左3/右2.5cm) 并在代码中允许配置。"
  front_matter:
    abstract_cn:
      title:
        text: "摘 要"
        font: "黑体"
        size: "三号"
        bold: true
        alignment: center
        line_spacing: single
        spacing_before_pt: 24
        spacing_after_pt: 18
      content:
        font_chinese: "宋体"
        font_western: "Times New Roman"
        size: "小四"
        line_spacing: "fixed_20pt"
        paragraph_spacing_before_pt: 0
        paragraph_spacing_after_pt: 0
        first_line_indent_chars: 0
        notes: "中文摘要正文未指定缩进，按照学校范文保持顶格；若示例要求可在配置中单独控制。"
      keywords:
        label_text: "关键词："
        label_bold: true
        separator: "；"
        alignment: left
        hanging_indent_chars: 4
        layout: "另起一行，隔行排列，左顶格"
    abstract_en:
      title:
        text: "ABSTRACT"
        font: "Times New Roman"
        size: "三号"
        bold: true
        alignment: center
        line_spacing: single
        spacing_before_pt: 24
        spacing_after_pt: 18
      content:
        font: "Times New Roman"
        size: "小四"
        line_spacing: "fixed_20pt"
        paragraph_spacing_before_pt: 0
        paragraph_spacing_after_pt: 0
        first_line_indent_chars: 0
      keywords:
        label_text: "Key Words:"
        label_bold: true
        separator: ";"
        alignment: left
        hanging_indent_chars: 6.5
        casing_rule: "每个关键词首字母大写"
    pagination:
      abstract_and_toc: "罗马数字页码，样例中摘要I、AbstractII"
  toc:
    title:
      text: "目 录"
      font: "黑体"
      size: "三号"
      line_spacing: single
      spacing_before_pt: 24
      spacing_after_pt: 18
    entries:
      font: "宋体"
      size: "小四"
      line_spacing: "fixed_20pt"
      spacing_before_pt: 0
      spacing_after_pt: 0
      indentation_chars:
        level1: 0
        level2: 2
        level3: 4
      formatting_rules:
        level1_bold: true
        page_numbers_alignment: right
        notes: "章标题左顶格加粗；目录页码行末右齐，应结合制表位+点线前导填充。"
  body:
    heading_level_1:
      numbering_format: "第一章、第二章..."
      font: "黑体"
      size: "三号"
      alignment: center
      spacing_before_pt: 24
      spacing_after_pt: 12
      notes: "规范仅提 \"根据示例默认设置\"，为满足隐式要求至少预留一行 (≥12pt) 段前段后；可在配置中校准。"
    heading_level_2:
      numbering_format: "第一节、第二节..."
      font: "黑体"
      size: "小三"
      alignment: left
      spacing_before_pt: 18
      spacing_after_pt: 9
    heading_level_3:
      numbering_format: "一、二、三..."
      font: "黑体"
      size: "四号"
      alignment: left
      spacing_before_pt: 12
      spacing_after_pt: 6
    paragraph:
      font_chinese: "宋体"
      font_western: "Times New Roman"
      size: "小四"
      line_spacing: "fixed_20pt"
      first_line_indent_chars: 2
      spacing_before_pt: 0
      spacing_after_pt: 0
    numbering_rules:
      level4: "1. 2. 3."
      level5: "（1）（2）（3）"
      mixing_note: "在标题中数字序号与汉字序号不可混用。"
  tables:
    caption:
      numbering_format: "表{chapter}-{seq}"
      position: "表上方居中"
      font: "宋体"
      size: "小四"
    content:
      font: "宋体"
      size: "小四"
      alignment: "根据数据居中或居左，全文保持一致"
    style:
      border_style: "three_line"
      lines:
        top_pt: 1.5
        middle_pt: 0.5
        bottom_pt: 1.5
  figures:
    caption:
      numbering_format: "图{chapter}-{seq}"
      position: "图下方居中"
      font: "宋体"
      size: "小四"
    notes: "图题与表题均需支持按章编号；样例 (FIGURE:3-1) 说明章节号+连字符格式。"
  formulas:
    alignment: center
    line_spacing: single
    numbering_format: "({seq})"
    numbering_position: "right_same_line"
    font: "Times New Roman"
    size: "小四"
    spacing_between_formula_and_number: "不加连线"
    typography:
      variable: italic
      constant: upright
      vector: bold_italic
      tensor: bold_upright
  references:
    title:
      text: "参 考 文 献"
      font: "黑体"
      size: "三号"
      line_spacing: single
      spacing_before_pt: 24
      spacing_after_pt: 18
    entries:
      numbering: "1. 2. 3. 顺序编码"
      font_chinese: "宋体"
      font_western: "Times New Roman"
      size: "小四"
      notes: "著录格式示例参照 filtered.md；需确保与正文引用联动。"
  acknowledgements:
    title:
      text: "致 谢"
      font: "黑体"
      size: "三号"
      line_spacing: single
      spacing_before_pt: 24
      spacing_after_pt: 18
    content:
      font: "宋体"
      size: "小四"
      line_spacing: "fixed_20pt"
  appendix:
    title:
      text: "附 录"
      font: "黑体"
      size: "三号"
      line_spacing: single
      spacing_before_pt: 24
      spacing_after_pt: 18
implicit_requirements:
  toc_features:
    clickable_entries: true
    bookmarks_per_heading_level: true
    pageref_fields: true
    hyperlink_color: "000000"
    dot_leader_tabs: true
  numbering_systems:
    figure_seq_fields: true
    table_seq_fields: true
    cross_referenceable_captions: true
  reference_links:
    citation_to_entry_links: true
    entry_backlinks_optional: true
    link_color: "000000"
  formula_handling:
    omml_format: true
    numbering_fields: true
  fonts_and_scripts:
    split_cjk_latin_runs: true
    enforce_configured_sizes_on_all_runs: true
  layout_defaults:
    enforce_min_spacing_between_title_and_body: true
    skip_empty_paragraphs: true
  error_handling:
    figure_placeholder_when_missing: true
    log_missing_assets: true
  miscellaneous:
    auto_update_fields_on_open: true
    sanitize_reference_text: true
conflict_analysis:
  - item: "参考文献编号样式"
    implicit_expectation: "最佳实践模板默认使用 [n] 括号编号及交叉引用。"
    explicit_requirement: "规范要求顺序编码并显示为 \"1. 2. 3.\"。"
    resolution: "配置 number.brackets 为 ['', '.'] 并仍保持交叉引用和书签机制。"
  - item: "目录交互 vs. 规范描述"
    implicit_expectation: "目录使用书签+超链接+PAGEREF。"
    explicit_requirement: "规范只描述排版与缩进。"
    resolution: "无冲突；保持可点击目录，同时应用学校提供的字体与缩进。"
  - item: "标题段前段后要求"
    implicit_expectation: "默认至少插入一行空白保证可读性。"
    explicit_requirement: "一级标题只写明 \"根据示例默认设置\"。"
    resolution: "采用24pt段前+12pt段后确保>=1行，同时保留可配置能力。"
  - item: "英文摘要缩进"
    implicit_expectation: "英文段落默认首行缩进2字符。"
    explicit_requirement: "示例未要求缩进，并强调关键词悬挂6.5字符。"
    resolution: "为保证一致性，默认0缩进，如后续样例要求再通过配置覆盖；关键词仍按显式要求悬挂。"
implementation_suggestions:
  must_use_methods:
    - "best_practices/目录系统_reference.py::_create_standard_hyperlink / _add_pageref_field 用于目录交互和页码刷新"
    - "best_practices/图表系统_reference.py::_add_seq_field / _add_chapter_based_seq_field 保障图表自动编号"
    - "best_practices/公式系统_reference.py::build_omml_runs 系列，输出OMML真公式"
    - "best_practices/字体样式_reference.py::set_mixed_font，确保 run.w:eastAsia+西文字体分离"
    - "best_practices/参考文献系统_reference.py::_add_internal_reference_link，维持正文引用↔文末条目跳转"
  adjustable_methods:
    - "图题/表题生成函数需要读取 numbering_format=章节号+连字符，题注位置遵循上方/下方要求"
    - "公式生成逻辑需允许全局编号格式 (1)(2) 并确保编号靠右同行"
    - "正文段落/heading style writer 应按配置写入 line_spacing=fixed20pt、段前段后值"
    - "关键词段落（中英文）需要实现悬挂缩进（4字符 vs 6.5字符）以及不同分隔符"
  school_specific_methods:
    - "解析器 parse_heading 需重点支持中文序列（第一章/第一节/一、），并保留 1./（1）等多级列表映射"
    - "TOC 生成需根据 level1/2/3 缩进字符数设置 left_indent，并保证 level1 加粗"
    - "页码分节：摘要+目录使用罗马数字，正文重启阿拉伯数字"
  self_check_log_items:
    - "生成代码后在日志输出：是否插入 TOC 域"
    - "章节书签数量（含附录、参考文献等特殊章节）"
    - "abstract/abstract_en 内容存在性"
    - "公式 OMML 支持是否启用"
    - "图片缺失占位+SEQ 题注是否写入"
    - "标题 run 是否写 eastAsia/size"
    - "段落的行距/段前/段后是否按配置落实"
  config_focus:
    - "提前在 config 中拆出 front_matter→abstract_cn / abstract_en，以便独立配置标题文案与缩进"
    - "figure/table/formula numbering_format 字段务必写死为章节号+连字符 / 全局括号数字"
    - "references.number.brackets 必须落地为无前缀+句点后缀"
  other_notes:
    - "中文关键词要求悬挂缩进4个字符且左顶格，英文关键词悬挂6.5字符且首字母大写"
    - "章节标题使用中文数字，不可与阿拉伯数字混用；多级编号列表应继承相同风格"
    - "中英内容混排处均需调用 set_mixed_font，防止宋体/Times fallback"
