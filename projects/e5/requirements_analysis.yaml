# 中国科学技术大学本科毕业论文格式 - 需求分析与补全
# 生成时间：2025-11-22
# 项目ID：e5

# ============================================================================
# 第一部分：显式需求（从 filtered.md 解析）
# ============================================================================

显式需求:

  文档设置:
    纸张大小: A4
    页边距:
      上边距: 2.54cm
      下边距: 2.54cm
      左边距: 3.17cm
      右边距: 3.17cm
      装订线: 0cm
    说明: 原文未明确说明，使用默认值

  全局字体配置:
    中文字体: 宋体
    英文字体: Times New Roman
    说明: 全文统一中英文分离处理

  中文摘要:
    标题:
      文字: "摘 要"
      字体: 黑体
      字号: 三号(16pt)
      对齐方式: 居中
      行距: 单倍行距
      段前间距: 24磅
      段后间距: 18磅

    内容:
      字体: 中文宋体，数字和英文Times New Roman
      字号: 小四(12pt)
      行距: 固定行距20磅
      段前间距: 0磅
      段后间距: 0磅
      首行缩进: 未明确（需补充默认值）

    关键词:
      位置: 摘要下方另起一行并隔行排列
      格式: "关键词：×××；×××；×××；×××"
      对齐: 左顶格
      缩进: 悬挂缩进4个字符
      字体: 中文宋体，数字和英文Times New Roman
      字号: 小四(12pt)
      分隔符: 分号(；)
      行距: 固定行距20磅

  英文摘要:
    标题:
      文字: "ABSTRACT"
      字体: Times New Roman
      字号: 三号(16pt)
      加粗: 是
      对齐方式: 居中
      行距: 单倍行距
      段前间距: 24磅
      段后间距: 18磅

    内容:
      字体: Times New Roman
      字号: 小四(12pt)
      行距: 固定行距20磅
      段前间距: 0磅
      段后间距: 0磅
      首行缩进: 未明确（需补充默认值）

    关键词:
      位置: 摘要下方另起一行并隔行排列
      格式: "Key Words: ×××; ×××; ×××; ×××"
      对齐: 左顶格
      缩进: 悬挂缩进6.5个字符
      字体: Times New Roman
      字号: 小四(12pt)
      分隔符: 分号(;)
      行距: 固定行距20磅
      大写要求: 每个关键词首字母大写

  目录:
    标题:
      文字: "目 录"
      字体: 黑体
      字号: 三号(16pt)
      对齐方式: 居中
      行距: 单倍行距
      段前间距: 24磅
      段后间距: 18磅

    目录项格式:
      字体: 中文宋体，数字和英文Times New Roman
      字号: 小四(12pt)
      行距: 固定行距20磅
      段前间距: 0磅
      段后间距: 0磅
      章标题: 左顶格并加粗
      节标题: 缩进2字符
      段标题: 缩进4字符
      页码: 行末右顶格
      生成方式: 默认使用TOC域自动生成

  正文标题分级:
    说明: 提供三种示例格式，全文统一一种格式
    示例1:
      章: "第一章 市场竞争"
      节: "第一节 市场竞争"
      段: "一、市场竞争"
      细分: "1. 市场竞争"
      更细分: "（1）市场竞争"
    示例2:
      章: "第1章 市场竞争"
      节: "1.1 市场竞争"
      段: "1.1.1 市场竞争"
      细分: "1. 市场竞争"
      更细分: "（1）市场竞争"
    示例3:
      章: "1 市场竞争"
      节: "1.1 市场竞争"
      段: "1.1.1 市场竞争"
      细分: "1. 市场竞争"
      更细分: "（1）市场竞争"
    注意: 数字序号和汉字序号不可混用
    默认采用: 示例2（第1章格式）

  一级标题_章:
    示例: "第一章 标题"
    字体: 黑体
    字号: 三号(16pt)
    对齐方式: 默认左对齐
    行距: 默认单倍行距
    段前间距: 默认24磅
    段后间距: 默认18磅

  二级标题_节:
    示例: "第一节 标题"
    字体: 黑体
    字号: 小三(15pt)
    对齐方式: 默认左对齐
    行距: 默认单倍行距
    段前间距: 默认24磅
    段后间距: 默认18磅

  三级标题_段:
    示例: "一、标题"
    字体: 黑体
    字号: 四号(14pt)
    对齐方式: 默认左对齐
    行距: 默认单倍行距
    段前间距: 默认24磅
    段后间距: 默认18磅

  正文段落:
    字体: 中文宋体，数字和英文Times New Roman
    字号: 小四(12pt)
    行距: 固定行距20磅
    首行缩进: 2字符
    段前间距: 0磅
    段后间距: 0磅

  页眉页码:
    页眉: 默认无特殊要求
    页码: 默认阿拉伯数字，居中，正文开始新节

  表格:
    表格样式: 三线表
    表格编号: 全文统一编号（如"表1"）或按章编号（如"表1.1"）
    表格标题:
      位置: 居表上方
      格式: "表1 员工人数统计"
      对齐方式: 居中
      字体: 宋体
      字号: 小四(12pt)
    表格内容:
      字体: 宋体
      字号: 小四或五号（全文统一）
    默认采用: 按章编号（表1.1格式），内容小四

  图片:
    图片编号: 全文统一编号或按章编号
    图片标题:
      位置: 居图下方
      对齐方式: 居中
      字体: 宋体
      字号: 小四(12pt)
    默认采用: 按章编号（图1.1格式）

  公式:
    排版:
      位置: 单独占行
      对齐方式: 居中
      行距: 单倍行距
    编号:
      位置: 用括号括起置于公式右边行末
      字体: 与段落文字相同（中文宋体，英文Times New Roman）
      字号: 与段落文字相同（小四）
      行距: 与段落文字相同（固定行距20磅）
      编号方式: 默认使用OMML（Office Math Markup Language）
    字体规范:
      变量: 白斜体
      常量和特殊函数: 白正体
      矢量: 黑斜体
      张量: 黑正体

  参考文献:
    标题:
      文字: "参 考 文 献"
      字体: 黑体
      字号: 三号(16pt)
      对齐方式: 居中
      行距: 单倍行距
      段前间距: 24磅
      段后间距: 18磅
    条目格式:
      编号方式: 顺序编码制
      字体: 中文宋体，英文Times New Roman
      字号: 小四(12pt)
      行距: 默认固定行距20磅
      段前间距: 默认0磅
      段后间距: 默认0磅
    著录格式示例:
      - 专著: "作者.书名[M].出版地：出版社，出版年."
      - 专著析出文献: "作者.书名[M].出版地：出版社，出版年:页码."
      - 期刊文章: "作者.文章题名[J].刊名，出版年，卷（期）:页码."
      - 学位论文: "作者.题名[博士学位论文].保存地：保存单位，年份."
      - 英文文献: "Author. Year. Title[J]. Journal Name, Volume:Pages."

  附录:
    标题:
      文字: "附 录"
      字体: 黑体
      字号: 三号(16pt)
      对齐方式: 居中
      行距: 单倍行距
      段前间距: 24磅
      段后间距: 18磅
    内容格式:
      字体: 中文宋体，数字和英文Times New Roman
      字号: 小四(12pt)
      行距: 固定行距20磅

  致谢:
    标题:
      文字: "致 谢"
      字体: 黑体
      字号: 三号(16pt)
      对齐方式: 居中
      行距: 单倍行距
      段前间距: 24磅
      段后间距: 18磅
    内容格式:
      字体: 中文宋体，数字和英文Times New Roman
      字号: 小四(12pt)
      行距: 固定行距20磅
      段前间距: 默认0磅
      段后间距: 默认0磅

# ============================================================================
# 第二部分：隐式需求（从 implementation_notes.md 补全）
# ============================================================================

隐式需求:

  目录功能:
    clickable_links:
      启用: true
      说明: 目录条目可点击跳转到对应章节
      实现: 使用 w:hyperlink + w:anchor 指向书签

    auto_page_numbers:
      启用: true
      说明: 页码会自动更新（不是手工改数字）
      实现: 使用 PAGEREF 字段

    link_color:
      启用: true
      说明: 超链接显示为黑色（不是Word默认蓝色）
      实现: w:color='000000'

    dot_leaders:
      启用: true
      说明: 目录标题和页码之间的点线前导符
      实现: 制表位 + dot leader

    toc_field:
      启用: true
      说明: 必须使用 Word 内置 TOC 域
      实现: 禁止手写目录段落，必须调用 Word 内置 TOC 域

    bookmark_system:
      启用: true
      说明: 为每个章节添加书签
      实现: _Chapter_1, _Chapter_2, _Heading_1_1 等

  图表功能:
    seq_fields:
      启用: true
      说明: 图表编号自动递增（插入/删除后自动调整）
      实现: 使用 SEQ 字段（不是硬编码）

    auto_numbering:
      启用: true
      说明: 编号是"活的"（Word中可以右键"更新域"刷新）
      实现: SEQ Figure / SEQ Table 字段

    chapter_based_numbering:
      启用: true
      说明: 按章节编号（如图1-1, 表2-3）
      实现: SEQ Figure_1, SEQ Figure_2 分章计数

    placeholder_for_missing_images:
      启用: true
      说明: 图片文件不存在时使用占位符
      实现: 红色文本"[图片缺失: 请检查路径]"，题注仍正常生成

  参考文献功能:
    citation_links:
      启用: true
      说明: 正文中的[1]可以点击跳转到参考文献列表
      实现: 超链接到 _Reference_1

    reference_bookmarks:
      启用: true
      说明: 文献条目添加书签
      实现: _Reference_1, _Reference_2 等

    black_citation_links:
      启用: true
      说明: 引用编号是黑色（不是蓝色）
      实现: w:color='000000'

    bidirectional_links:
      启用: false
      说明: 可选功能-文献列表可以跳回引用位置
      实现: 可选实现

  公式功能:
    omml_format:
      启用: true
      说明: 公式是真正的公式对象（可以右键"编辑公式"）
      实现: m:oMath 元素，不是纯文本

    editable_formulas:
      启用: true
      说明: 公式可编辑、可识别
      实现: OMML 格式支持

    formula_numbering:
      启用: true
      说明: 公式编号自动递增
      实现: SEQ Equation 字段

    formula_alignment:
      启用: true
      说明: 公式对齐控制
      实现: 根据配置设置居中/左对齐

    variable_style:
      启用: true
      说明: 公式变量样式控制（斜体/正体）
      实现: 根据学校要求设置 m:sty

  字体功能:
    separate_cjk_latin:
      启用: true
      说明: 中英文使用不同字体时，正确分离
      实现: w:eastAsia 和 w:ascii 分别设置

    explicit_font_tags:
      启用: true
      说明: run 级样式必须显式写 w:rFonts
      实现: 不能只用 run.font.name，必须写 XML 标签

    bold_italic_tags:
      启用: true
      说明: 加粗/斜体必须写 w:b、w:i
      实现: 抽取脚本只认 XML，缺少标签会判断为"未加粗"

    heading_number_font:
      启用: true
      说明: 标题编号 run 必须同步写字体信息
      实现: 编号 run 是段落第一个 run，必须写黑体信息

  页眉页码功能:
    section_breaks:
      启用: true
      说明: 正文开始新节，使用阿拉伯数字页码
      实现: 分节符 + 页码格式设置

    page_number_styles:
      启用: true
      说明: 支持罗马数字/阿拉伯数字页码
      实现: 摘要/目录用罗马数字，正文用阿拉伯数字

    header_content:
      启用: true
      说明: 正文页眉=论文题目，参考文献/致谢/附录页眉=章节名
      实现: 设置 is_linked_to_previous=False

    restart_page_numbering:
      启用: true
      说明: 正文页码从1重新开始
      实现: section.start_type = WD_SECTION.NEW_PAGE

  版面间距功能:
    spacing_between_sections:
      启用: true
      说明: 大小标题与正文内容之间至少有1个空行
      实现: 段前/段后距离设置

    heading_spacing:
      启用: true
      说明: 二级、三级标题也需要段前/段后空白
      实现: space_before/space_after 设置

    first_line_indent:
      启用: true
      说明: 中文/英文摘要默认首行缩进2字符
      实现: first_line_indent 设置

    keyword_hanging_indent:
      启用: true
      说明: 关键词悬挂缩进精确计算
      实现: 字符数 × 全角宽度估算

    explicit_line_spacing:
      启用: true
      说明: 行距必须显式设置
      实现: paragraph_format.line_spacing_rule 设置

  表格增强功能:
    table_header_repeat:
      启用: false
      说明: 可选功能-表头跨页重复
      实现: w:tblHeader 标签

    table_row_break:
      启用: true
      说明: 允许表格行跨页断行
      实现: w:cantSplit='0'

    three_line_table:
      启用: true
      说明: 三线表精确控制（上下1.5pt，中0.5pt）
      实现: XML 级别控制 w:tblBorders

  错误处理功能:
    skip_empty_paragraphs:
      启用: true
      说明: 跳过空段落
      实现: if not text.strip(): return

    sanitize_reference_text:
      启用: true
      说明: 参考文献文本清理（去除URL等）
      实现: _sanitize_reference_text() 方法

    image_placeholder:
      启用: true
      说明: 图片不存在时使用占位符
      实现: 红色文本 + 题注仍正常生成

# ============================================================================
# 第三部分：冲突分析
# ============================================================================

冲突分析:

  公式变量样式:
    隐式建议: 公式变量斜体（implementation_notes.md未明确）
    显式要求: 变量白斜体，常量白正体，矢量黑斜体，张量黑正体
    冲突: 无冲突
    采用: 显式要求（白斜体）

  公式编号位置:
    隐式建议: 未明确
    显式要求: 编号右对齐，与公式同一行
    冲突: 无冲突
    采用: 显式要求（right_same_line）

  图表编号格式:
    隐式建议: 使用SEQ字段（必须）
    显式要求: 未明确具体格式（"表1"或"表1.1"二选一）
    冲突: 无冲突
    采用: SEQ字段 + 默认采用"图1.1"/"表1.1"格式（按章编号）

  目录生成方式:
    隐式建议: 必须使用 Word 内置 TOC 域
    显式要求: 默认使用TOC域自动生成
    冲突: 无冲突
    采用: 完全一致

  超链接颜色:
    隐式建议: 黑色（不是蓝色）
    显式要求: 未明确
    冲突: 无冲突
    采用: 隐式建议（黑色）

  中英文字体分离:
    隐式建议: 必须分别设置 w:eastAsia 和 w:ascii
    显式要求: 中文宋体，英文Times New Roman
    冲突: 无冲突
    采用: 两者结合（显式字体 + 隐式实现方式）

  摘要首行缩进:
    隐式建议: 默认首行缩进2字符
    显式要求: 未明确
    冲突: 无冲突
    采用: 隐式建议（首行缩进2字符）

  表格样式:
    隐式建议: 三线表使用XML精确控制
    显式要求: 三线表
    冲突: 无冲突
    采用: XML级别控制（上下1.5pt，中0.5pt，无竖线）

  页码格式:
    隐式建议: 支持罗马数字/阿拉伯数字
    显式要求: 未明确摘要/目录页码，正文阿拉伯数字
    冲突: 无冲突
    采用: 默认摘要/目录用罗马数字，正文用阿拉伯数字

  标题间距:
    隐式建议: 二级、三级标题也需要段前/段后空白
    显式要求: 一二三级标题段前24磅，段后18磅
    冲突: 无冲突
    采用: 显式要求

  页眉设置:
    隐式建议: 正文页眉=论文题目，参考文献/致谢/附录页眉=章节名
    显式要求: 默认无特殊要求
    冲突: 无冲突
    采用: 实现页眉功能，但默认内容为空（可配置）

# ============================================================================
# 第四部分：实现建议
# ============================================================================

实现建议:

  99%会用上的方法列表:
    - _add_bookmark_to_paragraph: 添加书签
    - _create_standard_hyperlink: 创建黑色超链接
    - _add_pageref_field: PAGEREF页码字段
    - _add_tab_stop: 制表位（点线前导符）
    - _add_seq_field: 简单SEQ字段
    - _add_chapter_based_seq_field: 按章节的SEQ字段
    - _build_omml_runs: 构建OMML格式
    - _add_omml_text_run: 添加OMML文本
    - _apply_math_justification: 公式对齐
    - set_mixed_font: 中英文混排
    - _add_internal_reference_link: 内部超链接（黑色）
    - _add_text_with_citations: 处理正文引用

  按需调整的方法列表:
    - _add_figure: 核心逻辑复用，调整编号格式、题注位置、字体字号
    - _add_table: 核心逻辑复用，调整边框样式（三线表）
    - _add_formula: 核心逻辑复用，调整编号位置（同一行右对齐）
    - _generate_references: 核心逻辑复用，调整编号格式（[1]）
    - _set_table_borders: 三线表边框精确控制

  学校定制的方法列表:
    - parse_heading: 标题识别正则（支持"第1章"/"1.1"/"1.1.1"格式）
    - _format_toc_heading: 目录标题格式化（支持多种编号格式）
    - _chinese_to_arabic: 中文数字转换（支持"第一章"转"第1章"）

  强制自检清单:
    - [ ] 是否插入 TOC 域
    - [ ] 章节书签数量是否正确
    - [ ] abstract/abstract_en 是否有内容（若输入存在）
    - [ ] 公式 OMML 支持是否启用
    - [ ] 图片缺失时是否生成占位+SEQ 题注
    - [ ] 标题 run 是否写 eastAsia/size
    - [ ] 行距/段前后是否按配置写入
    - [ ] 目录超链接是否为黑色
    - [ ] 图表编号是否使用 SEQ 字段
    - [ ] 参考文献引用是否可点击跳转

  配置重点提示:
    - 标题编号格式: 默认采用"第1章"/"1.1"/"1.1.1"格式（示例2）
    - 图表编号格式: 默认采用"图1.1"/"表1.1"格式（按章编号）
    - 三线表边框: 上下1.5pt，中0.5pt，无竖线
    - 公式编号: 括号括起，右对齐，与公式同一行
    - 页码: 摘要/目录罗马数字，正文阿拉伯数字
    - 行距: 固定20磅（正文/摘要/目录/参考文献）
    - 标题间距: 段前24磅，段后18磅
    - 字体分离: 必须分别设置 w:eastAsia 和 w:ascii
    - TOC域: 必须使用 Word 内置 TOC 域，禁止手写目录

  其他建议:
    - 代码长度: Parser 400-600行，Formatter 1500-2000行，Styles 100-200行
    - 错误处理: 图片不存在用占位符，空段落跳过，参考文献文本清理
    - 配置驱动: 所有样式从config.json读取，不硬编码
    - 版面间距: 标题与正文间至少1个空行，摘要首行缩进2字符
    - 关键词缩进: 悬挂缩进精确计算（中文4字符，英文6.5字符）

# ============================================================================
# 第五部分：字号对照表
# ============================================================================

字号对照表:
  三号: 16pt
  小三: 15pt
  四号: 14pt
  小四: 12pt
  五号: 10.5pt
  小五: 9pt

# ============================================================================
# 第六部分：未明确的默认值补充
# ============================================================================

未明确的默认值补充:
  摘要内容首行缩进: 2字符（参照正文格式）
  英文摘要内容首行缩进: 2字符（参照正文格式）
  图表编号格式: 按章编号（图1.1/表1.1格式）
  表格内容字号: 小四（与标题一致）
  摘要页码: 罗马数字小写，居中，从i开始
  目录页码: 罗马数字小写，居中，继续摘要编号
  正文页码: 阿拉伯数字，居中，从1重新开始
  页眉内容: 默认为空（可配置为论文题目）
  参考文献编号格式: [1] [2] [3]（方括号）

# ============================================================================
# 文档结束
# ============================================================================
