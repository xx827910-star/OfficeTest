# 论文格式检测三方案对比总结

## 方案概览

| 方案 | 核心理念 | 脚本工作 | AI工作 | 粒度 |
|------|---------|---------|--------|------|
| **方案A** | AI主导判断 | 数据提取 + 单位转换 | 格式判断 + 完成度计算 | 粗粒度 |
| **方案B** | 平衡分工 | 数据提取 + 格式检查 + match判断 | 验证 + 语义判断 + 完成度计算 | 中粒度 |
| **方案C** | 脚本主导判断 | 数据提取 + 规则检查 + 完成度计算 | 验证 + 生成报告 | 细粒度 |

---

## 详细对比

### 1. 脚本输出对比

#### 方案A - 只输出格式数据
```json
{
  "page_setup": {
    "margin_top": "2.0 cm",           // 只有值，无expected和match
    "margin_bottom": "2.0 cm"
  },
  "sections": {
    "main": {
      "h1": {
        "count": 6,
        "items": [
          {
            "text": "第1章 绪论",
            "font": "宋体",              // 只有实际值
            "size": "三号(16pt)",
            "bold": true
          }
        ]
      }
    }
  }
}
```

#### 方案B - 输出格式数据 + 检查结果
```json
{
  "page_setup": {
    "margins": {
      "top": {
        "value": "2.0 cm",              // 实际值
        "expected": "2.0 cm",           // 期望值
        "match": true                    // 脚本判断
      }
    }
  },
  "sections": {
    "main": {
      "h1": {
        "count": 6,
        "items": [
          {
            "text": "第1章 绪论",
            "format": {
              "font": {
                "value": "宋体",
                "expected": "宋体",
                "match": true            // 每项都有match
              },
              "size": {...}
            }
          }
        ]
      }
    }
  }
}
```

#### 方案C - 输出详细检查清单
```json
{
  "rule_checks": {
    "page_setup": {
      "rules": [
        {
          "rule_id": "R001",
          "rule_name": "页边距-上",
          "description": "上边距应为 2.0 cm",
          "expected": "2.0 cm",
          "actual": "2.0 cm",
          "passed": true               // 规则级别的检查
        }
      ],
      "completion": {
        "total": 6,
        "passed": 6,
        "completion": 100.0          // 预计算的完成度
      }
    },
    "main_content": {
      "h1": {
        "rules": [
          {
            "rule_id": "R050",
            "rule_name": "一级标题-字体",
            "expected": "宋体",
            "actual": "宋体",
            "passed": true,
            "item_index": 69,
            "item_text": "第1章 绪论"   // 精确到每个标题
          }
          // ... 6个标题 × 7条规则 = 42项检查
        ],
        "completion": {
          "total": 42,
          "passed": 42,
          "completion": 100.0
        }
      }
    }
  },
  "completion_summary": {
    "overall": 95.3,                    // 预计算的总体完成度
    "by_category": {...}
  }
}
```

---

### 2. AI提示词对比

#### 方案A - AI需要全面判断
```markdown
## 你的工作

### 步骤1：理解格式规范
仔细阅读规范MD文件，提取所有可检查的格式要求

### 步骤2：逐项对比检查
对JSON中的每个格式项，与规范对比，判断是否符合

示例：
- 规范要求：上边距 2.0 cm
- 实际数据：`"margin_top": "2.0 cm"`
- 判断：✓ 符合

### 步骤3：计算完成度
根据通过/失败项计算每个类别和总体的完成度

### 步骤4：生成报告
```

#### 方案B - AI验证并补充
```markdown
## 你的工作

### 步骤1：理解JSON结构
脚本已提供{value, expected, match}，理解其含义

### 步骤2：验证脚本判断
检查脚本的match结果是否合理

### 步骤3：补充语义判断
判断脚本无法处理的主观要求（如"简明扼要"）

### 步骤4：计算完成度
根据match统计计算完成度

### 步骤5：生成报告
```

#### 方案C - AI只验证和报告
```markdown
## 你的工作

### 步骤1：验证规则判断
抽查部分规则检查结果，确认脚本判断是否合理

### 步骤2：验证完成度计算
检查脚本的完成度计算是否正确

### 步骤3：补充语义判断
判断脚本无法处理的主观要求

### 步骤4：生成最终报告
直接使用脚本提供的数据生成报告
```

---

### 3. 性能对比

| 指标 | 方案A | 方案B | 方案C |
|------|-------|-------|-------|
| **脚本复杂度** | 低 | 中 | 高 |
| **脚本开发时间** | 1-2天 | 3-5天 | 5-7天 |
| **脚本代码量** | ~500行 | ~1000行 | ~1500行 |
| **AI Token消耗** | 5-7K | 3-4K | 1-2K |
| **单次检测成本** | 高 | 中 | 低 |
| **检测速度** | 慢 | 中 | 快 |
| **结果稳定性** | 低 | 高 | 最高 |
| **可调试性** | 差 | 好 | 优秀 |
| **可扩展性** | 好 | 中 | 需修改规则库 |

---

### 4. 工作流对比

#### 方案A工作流
```
docx → 脚本(提取数据) → format_data.json
                            ↓
                        AI(全部判断) → 完成度报告
```

#### 方案B工作流
```
docx → 脚本(提取+检查) → format_summary.json
                            ↓
                        AI(验证+补充) → 完成度报告
```

#### 方案C工作流
```
docx → 脚本(提取+检查+计算) → format_check.json
                                ↓
                            AI(验证+报告) → 完成度报告
```

---

### 5. 适用场景对比

#### 方案A适合
- ✅ 快速原型验证
- ✅ 一次性检测（检测次数少）
- ✅ 格式规范复杂多变
- ✅ 对成本不敏感
- ❌ 不适合大规模批量检测
- ❌ 不适合需要稳定结果的场景

#### 方案B适合
- ✅ 生产环境
- ✅ 中等规模检测（10-100个文档）
- ✅ 需要平衡开发成本和运行成本
- ✅ 需要可调试的检测流程
- ✅ **推荐用于当前项目**

#### 方案C适合
- ✅ 大规模批量检测（100+个文档）
- ✅ 需要最稳定的检测结果
- ✅ 对检测成本敏感
- ✅ 格式规范相对固定
- ✅ 需要详细的问题追溯
- ❌ 不适合快速迭代的场景

---

### 6. 检测准确性对比

#### 准确性影响因素

| 因素 | 方案A | 方案B | 方案C |
|------|-------|-------|-------|
| **单位转换** | 脚本完成 ✓ | 脚本完成 ✓ | 脚本完成 ✓ |
| **样式继承** | 脚本完成 ✓ | 脚本完成 ✓ | 脚本完成 ✓ |
| **格式匹配** | AI判断 ⚠️ | 脚本判断 ✓ | 规则引擎 ✓✓ |
| **完成度计算** | AI计算 ⚠️ | AI计算 ⚠️ | 脚本计算 ✓✓ |
| **一致性** | 低 | 中 | 高 |
| **可重复性** | 差 | 好 | 优秀 |

#### 准确性排序
```
方案C > 方案B > 方案A
```

---

### 7. 成本分析（以检测100个文档为例）

#### 开发成本
- 方案A：1-2天 × 开发成本
- 方案B：3-5天 × 开发成本
- 方案C：5-7天 × 开发成本

#### 运行成本（AI Token）
- 方案A：100文档 × 6K tokens × Token单价 = 约$3-5
- 方案B：100文档 × 3.5K tokens × Token单价 = 约$1.5-2.5
- 方案C：100文档 × 1.5K tokens × Token单价 = 约$0.5-1

#### 总成本（假设检测100次）
- 方案A：开发成本低 + 运行成本高 = **适合少量检测**
- 方案B：开发成本中 + 运行成本中 = **平衡选择**
- 方案C：开发成本高 + 运行成本低 = **适合大量检测**

---

## 推荐方案

### 当前项目推荐：方案B（中粒度）

**理由**：
1. **平衡性好**：开发成本和运行成本都适中
2. **适合迭代**：检测v01-v13，需要多次运行，方案B成本合理
3. **结果可靠**：脚本做了基础检查，AI补充验证，准确性高
4. **易于调试**：问题定位明确，便于改进

### 未来扩展建议

如果后续需要：
- **快速测试新想法** → 用方案A
- **大规模批量检测** → 升级到方案C

---

## 实施建议

### 第一阶段：实现方案B
1. 在Code AI对话中实现 `extract_format.py`
2. 批量处理v01-v13 + test.docx
3. 在Agent AI对话中测试检测效果

### 第二阶段：观察效果
1. 检查v01-v13的完成度曲线是否合理
2. 验证test.docx是否达到95%+
3. 分析哪些格式问题被正确识别

### 第三阶段：根据需要调整
- 如果方案B效果好 → 继续使用
- 如果需要更高准确性 → 升级到方案C
- 如果只是测试 → 简化为方案A

---

## 三方案文件清单

已创建文档：
- ✅ `方案A_粗粒度检测方案.md`
- ✅ `方案B_中粒度检测方案.md`（原`方案二_中粒度检测方案.md`）
- ✅ `方案C_细粒度检测方案.md`
- ✅ `三方案对比总结.md`（本文档）

下一步：选择方案并在其他对话中实现。
